<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>基于Qt自定义视觉界面 | GtHawkeye视觉平台</title>
    <meta name="description" content="Welcome">
    
    
    <link rel="preload" href="/assets/css/0.styles.177b5ee6.css" as="style"><link rel="preload" href="/assets/js/app.e904eec8.js" as="script"><link rel="preload" href="/assets/js/16.16066f5a.js" as="script"><link rel="prefetch" href="/assets/js/10.cdff6104.js"><link rel="prefetch" href="/assets/js/11.6d4e6612.js"><link rel="prefetch" href="/assets/js/12.24597b9c.js"><link rel="prefetch" href="/assets/js/13.c5e4b4e0.js"><link rel="prefetch" href="/assets/js/14.dd52ec26.js"><link rel="prefetch" href="/assets/js/15.d6de0f45.js"><link rel="prefetch" href="/assets/js/17.ff624283.js"><link rel="prefetch" href="/assets/js/18.5310fd53.js"><link rel="prefetch" href="/assets/js/19.76ed3803.js"><link rel="prefetch" href="/assets/js/2.91fbb1e9.js"><link rel="prefetch" href="/assets/js/3.f4cdf44e.js"><link rel="prefetch" href="/assets/js/4.7209c065.js"><link rel="prefetch" href="/assets/js/5.1eae4793.js"><link rel="prefetch" href="/assets/js/6.0a2e8849.js"><link rel="prefetch" href="/assets/js/7.98b78ba0.js"><link rel="prefetch" href="/assets/js/8.a1c7d56c.js"><link rel="prefetch" href="/assets/js/9.34fafb42.js">
    <link rel="stylesheet" href="/assets/css/0.styles.177b5ee6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">GtHawkeye视觉平台</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/handbook/handbook2-quickuse.html" class="nav-link">使用软件</a></div><div class="nav-item"><a href="/module_program/module1-env.html" class="nav-link">开发算法模块</a></div><div class="nav-item"><a href="/ui_program/ui_program_intro.html" class="nav-link">自定义视觉界面</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/handbook/handbook2-quickuse.html" class="nav-link">使用软件</a></div><div class="nav-item"><a href="/module_program/module1-env.html" class="nav-link">开发算法模块</a></div><div class="nav-item"><a href="/ui_program/ui_program_intro.html" class="nav-link">自定义视觉界面</a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading open"><span>开发视觉界面</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/ui_program/ui_program_intro.html" class="sidebar-link">自定义视觉界面</a></li><li><a href="/ui_program/qt_program.html" class="active sidebar-link">基于Qt自定义视觉界面</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ui_program/qt_program.html#函数库依赖" class="sidebar-link">函数库依赖</a></li><li class="sidebar-sub-header"><a href="/ui_program/qt_program.html#必要函数接口" class="sidebar-link">必要函数接口</a></li><li class="sidebar-sub-header"><a href="/ui_program/qt_program.html#函数操作流程" class="sidebar-link">函数操作流程</a></li><li class="sidebar-sub-header"><a href="/ui_program/qt_program.html#代码示例" class="sidebar-link">代码示例</a></li><li class="sidebar-sub-header"><a href="/ui_program/qt_program.html#qt界面示例" class="sidebar-link">QT界面示例</a></li></ul></li><li><a href="/ui_program/ui_update_log.html" class="sidebar-link">更新日志</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="基于qt自定义视觉界面"><a href="#基于qt自定义视觉界面" aria-hidden="true" class="header-anchor">#</a> 基于Qt自定义视觉界面</h1> <h2 id="函数库依赖"><a href="#函数库依赖" aria-hidden="true" class="header-anchor">#</a> 函数库依赖</h2> <h5 id="_1、头文件"><a href="#_1、头文件" aria-hidden="true" class="header-anchor">#</a> 1、头文件</h5> <ul><li>gt_display.h        用于显示图像和图像控件的库</li> <li>result_type.h       定义图像数据结构和结果数据结构</li> <li>workflow_list.h   函数调用头文件</li></ul> <h2 id="必要函数接口"><a href="#必要函数接口" aria-hidden="true" class="header-anchor">#</a> 必要函数接口</h2> <h5 id="_1、回调函数，用于接受库内运行时的一帧图像数据"><a href="#_1、回调函数，用于接受库内运行时的一帧图像数据" aria-hidden="true" class="header-anchor">#</a> 1、回调函数，用于接受库内运行时的一帧图像数据</h5> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span><span class="token punctuation">(</span><span class="token operator">*</span>CallbackFun<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">const</span> GtMat <span class="token operator">*</span>image<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>user<span class="token punctuation">,</span> <span class="token keyword">int</span> ccd_index<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="_2、工程设置相关函数"><a href="#_2、工程设置相关函数" aria-hidden="true" class="header-anchor">#</a> 2、工程设置相关函数</h5> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">getMdlCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bool <span class="token function">setMdlParam</span><span class="token punctuation">(</span><span class="token keyword">int</span> mdl_position<span class="token punctuation">,</span> <span class="token keyword">const</span> QJsonObject <span class="token operator">&amp;</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//参数设置，mdl_position是模块在流程中的位置</span>
</code></pre></div><p>下面两个函数是读取和保存本地绝对路径下工程配置</p> <div class="language-c extra-class"><pre class="language-c"><code>bool <span class="token function">saveProject</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//保存工程</span>
bool <span class="token function">readProject</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//读取本地工程</span>
</code></pre></div><p>该函数是启动workflow运行的函数，第一个参数是通过getMDLCount()函数返回，如果是true就表示当前的workflow里面没有功能模块，当前工作流只是能拍照，false就是包含有其他功能模块，第二个参数是运行模式，true是自动循环，false是触发或者运行有限次数模式，第三个参数的意思是运行有限次模式下的次数，无限模式下此参数无效。</p> <div class="language-c extra-class"><pre class="language-c"><code>bool <span class="token function">startProcess</span><span class="token punctuation">(</span>bool capture_only<span class="token punctuation">,</span> bool run_forever<span class="token punctuation">,</span> <span class="token keyword">int</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 当仅采集时，capture_only为true，当一直运行的时候，run_forever为true，否则设置运行帧数count即可</span>
bool <span class="token function">stopProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 停止运行</span>
<span class="token keyword">int</span> <span class="token function">getLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//获取错误码</span>
</code></pre></div><h5 id="_3、相机操作相关函数"><a href="#_3、相机操作相关函数" aria-hidden="true" class="header-anchor">#</a> 3、相机操作相关函数</h5> <p>该函数扫描本地可使用的相机名字信息，返回一个QStringList的结果</p> <div class="language-c extra-class"><pre class="language-c"><code>QStringList <span class="token function">scanCamera</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>该函数使用上一步扫描到的结果来连接相机，返回值为bool类型，相机连接成功就返回true，否则就返回false</p> <div class="language-c extra-class"><pre class="language-c"><code>bool <span class="token function">connectCamera</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="_4、获取结果相关函数"><a href="#_4、获取结果相关函数" aria-hidden="true" class="header-anchor">#</a> 4、获取结果相关函数</h5> <p>该函数功能是获取指定模块可用来绘图的图片内容地址指作为，做为display等绘图控件的输入信息</p> <div class="language-c extra-class"><pre class="language-c"><code>DrawableResult <span class="token operator">*</span><span class="token function">getDrawableResultPtr</span><span class="token punctuation">(</span><span class="token keyword">int</span> position<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="_5、绘图相关函数"><a href="#_5、绘图相关函数" aria-hidden="true" class="header-anchor">#</a> 5、绘图相关函数</h5> <p>该函数是在开始运行workflow之前打开workflow中带有绘制结果功能模块的使能，以便matchshape模块在计算出结果后，自动把结果坐标和ROI局域自动绘制到display的控件上</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">startDrawResult</span><span class="token punctuation">(</span>DrawableResult <span class="token operator">*</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">stopDrawResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>该函数是向workflow里注册一个回调函数，当workflow运行完毕的时候，会主动调用此函数，通知外层代码以便进一步处理</p> <div class="language-c extra-class"><pre class="language-c"><code>bool <span class="token function">registerCallback</span><span class="token punctuation">(</span>CallbackFun fun<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="_6、设置matchshape的json参数jobject"><a href="#_6、设置matchshape的json参数jobject" aria-hidden="true" class="header-anchor">#</a> 6、设置MatchShape的JSON参数JObject</h5> <div class="language-json extra-class"><pre class="language-json"><code>            <span class="token property">&quot;MdlParam&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;angle_step&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>    //特征角度最小步进
                <span class="token property">&quot;end_angle&quot;</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>    //搜索截止角度
                <span class="token property">&quot;high_thresh&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>   //roi 特征提取阀值上限
                <span class="token property">&quot;levels&quot;</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>        //图像搜索的层数
                <span class="token property">&quot;low_thresh&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>    //roi特征提取阀值下限
                <span class="token property">&quot;min_score&quot;</span><span class="token operator">:</span> <span class="token number">0.800000011920929</span><span class="token punctuation">,</span> //特征匹配的最小匹配百分比
                <span class="token property">&quot;pattern_rect&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>               //roi区域的范围
                    <span class="token number">582</span><span class="token punctuation">,</span>
                    <span class="token number">585</span><span class="token punctuation">,</span>
                    <span class="token number">336</span><span class="token punctuation">,</span>
                    <span class="token number">343</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token property">&quot;search_number&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>     //特征目标个数
                <span class="token property">&quot;start_angle&quot;</span><span class="token operator">:</span> -<span class="token number">30</span><span class="token punctuation">,</span>     //搜索起始角度
                <span class="token property">&quot;use_subpixle&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>    //图像使用亚像素精度
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="函数操作流程"><a href="#函数操作流程" aria-hidden="true" class="header-anchor">#</a> 函数操作流程</h2> <h5 id="_1、读取本地工程，同步界面参数，建立workflow"><a href="#_1、读取本地工程，同步界面参数，建立workflow" aria-hidden="true" class="header-anchor">#</a> 1、读取本地工程，同步界面参数，建立workflow</h5> <div class="language-c extra-class"><pre class="language-c"><code>bool flag <span class="token operator">=</span> workflow_list<span class="token operator">-&gt;</span><span class="token function">readProject</span><span class="token punctuation">(</span>item_path<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="_2、-扫描本地相机，同步界面或者确定所使用的相机"><a href="#_2、-扫描本地相机，同步界面或者确定所使用的相机" aria-hidden="true" class="header-anchor">#</a> 2、 扫描本地相机，同步界面或者确定所使用的相机</h5> <div class="language-c extra-class"><pre class="language-c"><code>camera <span class="token operator">=</span> workflow_list<span class="token operator">-&gt;</span><span class="token function">scanCamera</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="_3、保存界面参数到本地json配置文件并设置到workflow"><a href="#_3、保存界面参数到本地json配置文件并设置到workflow" aria-hidden="true" class="header-anchor">#</a> 3、保存界面参数到本地JSON配置文件并设置到workflow</h5> <div class="language-c extra-class"><pre class="language-c"><code>workflow_list<span class="token operator">-&gt;</span><span class="token function">setMdlParam</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> json<span class="token punctuation">)</span><span class="token punctuation">;</span>
workflow_list<span class="token operator">-&gt;</span><span class="token function">saveProject</span><span class="token punctuation">(</span>item_path<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="_4、注册回调函数关联信号槽启动display绘图功能并启动workflow"><a href="#_4、注册回调函数关联信号槽启动display绘图功能并启动workflow" aria-hidden="true" class="header-anchor">#</a> 4、注册回调函数关联信号槽启动display绘图功能并启动workflow</h5> <div class="language-c extra-class"><pre class="language-c"><code>ui<span class="token punctuation">.</span>display_lay<span class="token operator">-&gt;</span><span class="token function">addWidget</span><span class="token punctuation">(</span>display<span class="token operator">-&gt;</span><span class="token function">createDisplay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//把display的widget添加到一个laylout上</span>
bool is_capture <span class="token operator">=</span> workflow_list<span class="token operator">-&gt;</span><span class="token function">getMdlCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>
display<span class="token operator">-&gt;</span><span class="token function">startDrawResult</span><span class="token punctuation">(</span>workflow_list<span class="token operator">-&gt;</span><span class="token function">getDrawableResultPtr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
workflow_list<span class="token operator">-&gt;</span><span class="token function">registerCallback</span><span class="token punctuation">(</span>dealResult<span class="token punctuation">,</span>this<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">connect</span><span class="token punctuation">(</span>display<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GtDisplay<span class="token punctuation">:</span><span class="token punctuation">:</span>signalUpdateDefaultItem<span class="token punctuation">,</span> this<span class="token punctuation">,</span> <span class="token operator">&amp;</span>MatchShapeLite<span class="token punctuation">:</span><span class="token punctuation">:</span>slotUpdateRoi<span class="token punctuation">)</span><span class="token punctuation">;</span>
success <span class="token operator">=</span> workflow_list<span class="token operator">-&gt;</span><span class="token function">startProcess</span><span class="token punctuation">(</span>is_capture<span class="token punctuation">,</span> true<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="_5、关闭display绘图工程停止workflow并解除信号连接"><a href="#_5、关闭display绘图工程停止workflow并解除信号连接" aria-hidden="true" class="header-anchor">#</a> 5、关闭display绘图工程停止workflow并解除信号连接</h5> <div class="language-c extra-class"><pre class="language-c"><code>display<span class="token operator">-&gt;</span><span class="token function">stopDrawResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">disconnect</span><span class="token punctuation">(</span>display<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GtDisplay<span class="token punctuation">:</span><span class="token punctuation">:</span>signalUpdateDefaultItem<span class="token punctuation">,</span> this<span class="token punctuation">,</span> <span class="token operator">&amp;</span>MatchShapeLite<span class="token punctuation">:</span><span class="token punctuation">:</span>slotUpdateRoi<span class="token punctuation">)</span><span class="token punctuation">;</span>
workflow_list<span class="token operator">-&gt;</span><span class="token function">stopProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="代码示例"><a href="#代码示例" aria-hidden="true" class="header-anchor">#</a> 代码示例</h2> <h5 id="_1、matchshapelite-h"><a href="#_1、matchshapelite-h" aria-hidden="true" class="header-anchor">#</a> 1、MatchShapeLite.h</h5> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property">#<span class="token directive keyword">pragma</span> once</span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QtWidgets/QMainWindow&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&quot;ui_MatchShapeLite.h&quot;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&quot;gt_display.h&quot;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&quot;workflow_list.h&quot;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&quot;result_type.h&quot;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QJsonObject&gt;</span></span>
<span class="token comment">/*
 *回调函数指针声明设置
 */</span>
<span class="token keyword">typedef</span> <span class="token keyword">void</span><span class="token punctuation">(</span><span class="token operator">*</span>CallbackFun<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">const</span> GtMat <span class="token operator">*</span>image<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>user<span class="token punctuation">,</span> <span class="token keyword">int</span> ccd_index<span class="token punctuation">)</span><span class="token punctuation">;</span>

class MatchShapeLite <span class="token punctuation">:</span> public QMainWindow
<span class="token punctuation">{</span>
	Q_OBJECT
public<span class="token punctuation">:</span>
	<span class="token function">MatchShapeLite</span><span class="token punctuation">(</span>QWidget <span class="token operator">*</span>parent <span class="token operator">=</span> Q_NULLPTR<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token operator">~</span><span class="token function">MatchShapeLite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">openProjectPath</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">dealResult</span><span class="token punctuation">(</span><span class="token keyword">const</span> GtMat <span class="token operator">*</span>image<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>user<span class="token punctuation">,</span> <span class="token keyword">int</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>

public slots<span class="token punctuation">:</span>
	<span class="token keyword">void</span> <span class="token function">slotopen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">slotrun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">slotquit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">slotsave</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">slotUpdateRoi</span><span class="token punctuation">(</span>bool valid<span class="token punctuation">,</span> <span class="token keyword">double</span> reserve0<span class="token punctuation">,</span> <span class="token keyword">double</span> reserve1<span class="token punctuation">,</span>
		<span class="token keyword">double</span> reserve2<span class="token punctuation">,</span> <span class="token keyword">double</span> reserve3<span class="token punctuation">,</span> <span class="token keyword">double</span> reserve4<span class="token punctuation">,</span> QString <span class="token operator">&amp;</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//display里面roi设置变更信号回调信号槽函数</span>
	<span class="token keyword">void</span> <span class="token function">slotscan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">slotconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
 *下面四个信号和槽函数用于线程里使用信号和槽机制，否则不予不同线程的函数将无法使用
 */</span>
	<span class="token keyword">void</span> <span class="token function">slotupdate</span><span class="token punctuation">(</span>QPixmap map<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//这里带参数的信号和槽函数必须使用参数的值复制的形式，引用无效</span>
	<span class="token keyword">void</span> <span class="token function">slotresult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
signals<span class="token punctuation">:</span>
	<span class="token keyword">void</span> <span class="token function">signupdate</span><span class="token punctuation">(</span>QPixmap map<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">signresult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
private<span class="token punctuation">:</span>
	Ui<span class="token punctuation">:</span><span class="token punctuation">:</span>MatchShapeLiteClass ui<span class="token punctuation">;</span>
	WorkflowList <span class="token operator">*</span>workflow_list<span class="token punctuation">;</span>			<span class="token comment">//必要的工作流配置对象</span>
	GtDisplay <span class="token operator">*</span> display<span class="token punctuation">;</span>					<span class="token comment">//必要的界面显示对象</span>

	QString item_path<span class="token punctuation">;</span>						<span class="token comment">//工程打开路径保存</span>
	QJsonObject json<span class="token punctuation">;</span>						<span class="token comment">//工作配置临时保存</span>
	QStringList camera<span class="token punctuation">;</span>						<span class="token comment">//链接相机信息保存</span>
	QStatusBar <span class="token operator">*</span>sBar<span class="token punctuation">;</span>						<span class="token comment">//增加状态栏</span>
	QLabel <span class="token operator">*</span>label<span class="token punctuation">;</span>							<span class="token comment">//状态栏里面用于显示结果</span>
	<span class="token keyword">char</span> <span class="token operator">*</span>image_data_<span class="token punctuation">;</span>						<span class="token comment">//图像原始数据保存位置</span>
	QPixmap map<span class="token punctuation">;</span>							<span class="token comment">//回调参考图片复制到map</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><h5 id="_2、matchshapelite-cpp"><a href="#_2、matchshapelite-cpp" aria-hidden="true" class="header-anchor">#</a> 2、MatchShapeLite.cpp</h5> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&quot;MatchShapeLite.h&quot;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QFileDialog&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QJsonObject&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QJsonDocument&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QJsonArray&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QPixmap&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QDebug&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QMessageBox&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QStatusBar&gt;</span></span>

MatchShapeLite<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">MatchShapeLite</span><span class="token punctuation">(</span>QWidget <span class="token operator">*</span>parent<span class="token punctuation">)</span>
	<span class="token punctuation">:</span> <span class="token function">QMainWindow</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	ui<span class="token punctuation">.</span><span class="token function">setupUi</span><span class="token punctuation">(</span>this<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//this-&gt;setWindowOpacity(0.7);</span>
	<span class="token comment">//this-&gt;setWindowFlags(Qt::FramelessWindowHint);</span>
	ui<span class="token punctuation">.</span>run<span class="token operator">-&gt;</span><span class="token function">setEnabled</span><span class="token punctuation">(</span>false<span class="token punctuation">)</span><span class="token punctuation">;</span>
	ui<span class="token punctuation">.</span>quit<span class="token operator">-&gt;</span><span class="token function">setEnabled</span><span class="token punctuation">(</span>false<span class="token punctuation">)</span><span class="token punctuation">;</span>
	ui<span class="token punctuation">.</span>connect<span class="token operator">-&gt;</span><span class="token function">setEnabled</span><span class="token punctuation">(</span>false<span class="token punctuation">)</span><span class="token punctuation">;</span>

	workflow_list <span class="token operator">=</span> new WorkflowList<span class="token punctuation">;</span><span class="token comment">//创建工作流对象</span>
	display <span class="token operator">=</span> new GtDisplay<span class="token punctuation">;</span><span class="token comment">//创建显示widget</span>
	<span class="token function">connect</span><span class="token punctuation">(</span>display<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GtDisplay<span class="token punctuation">:</span><span class="token punctuation">:</span>signalUpdateDefaultItem<span class="token punctuation">,</span> this<span class="token punctuation">,</span> <span class="token operator">&amp;</span>MatchShapeLite<span class="token punctuation">:</span><span class="token punctuation">:</span>slotUpdateRoi<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置显示widget里面roi窗口的设置变动信号</span>
	ui<span class="token punctuation">.</span>display_lay<span class="token operator">-&gt;</span><span class="token function">addWidget</span><span class="token punctuation">(</span>display<span class="token operator">-&gt;</span><span class="token function">createDisplay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>									<span class="token comment">//向一个已知的布局中加入显示widget</span>
	<span class="token function">connect</span><span class="token punctuation">(</span>ui<span class="token punctuation">.</span>openfile<span class="token punctuation">,</span><span class="token operator">&amp;</span>QPushButton<span class="token punctuation">:</span><span class="token punctuation">:</span>clicked<span class="token punctuation">,</span>this<span class="token punctuation">,</span><span class="token operator">&amp;</span>MatchShapeLite<span class="token punctuation">:</span><span class="token punctuation">:</span>slotopen<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">connect</span><span class="token punctuation">(</span>ui<span class="token punctuation">.</span>run<span class="token punctuation">,</span><span class="token operator">&amp;</span>QPushButton<span class="token punctuation">:</span><span class="token punctuation">:</span>clicked<span class="token punctuation">,</span>this<span class="token punctuation">,</span><span class="token operator">&amp;</span>MatchShapeLite<span class="token punctuation">:</span><span class="token punctuation">:</span>slotrun<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">connect</span><span class="token punctuation">(</span>ui<span class="token punctuation">.</span>quit<span class="token punctuation">,</span><span class="token operator">&amp;</span>QPushButton<span class="token punctuation">:</span><span class="token punctuation">:</span>clicked<span class="token punctuation">,</span>this<span class="token punctuation">,</span><span class="token operator">&amp;</span>MatchShapeLite<span class="token punctuation">:</span><span class="token punctuation">:</span>slotquit<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">connect</span><span class="token punctuation">(</span>ui<span class="token punctuation">.</span>save<span class="token punctuation">,</span><span class="token operator">&amp;</span>QPushButton<span class="token punctuation">:</span><span class="token punctuation">:</span>clicked<span class="token punctuation">,</span>this<span class="token punctuation">,</span><span class="token operator">&amp;</span>MatchShapeLite<span class="token punctuation">:</span><span class="token punctuation">:</span>slotsave<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">connect</span><span class="token punctuation">(</span>ui<span class="token punctuation">.</span>scan<span class="token punctuation">,</span><span class="token operator">&amp;</span>QPushButton<span class="token punctuation">:</span><span class="token punctuation">:</span>clicked<span class="token punctuation">,</span>this<span class="token punctuation">,</span><span class="token operator">&amp;</span>MatchShapeLite<span class="token punctuation">:</span><span class="token punctuation">:</span>slotscan<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token function">connect</span><span class="token punctuation">(</span>this<span class="token punctuation">,</span> <span class="token operator">&amp;</span>MatchShapeLite<span class="token punctuation">:</span><span class="token punctuation">:</span>signupdate<span class="token punctuation">,</span> this<span class="token punctuation">,</span> <span class="token operator">&amp;</span>MatchShapeLite<span class="token punctuation">:</span><span class="token punctuation">:</span>slotupdate<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">connect</span><span class="token punctuation">(</span>this<span class="token punctuation">,</span> <span class="token operator">&amp;</span>MatchShapeLite<span class="token punctuation">:</span><span class="token punctuation">:</span>signresult<span class="token punctuation">,</span>this<span class="token punctuation">,</span><span class="token operator">&amp;</span>MatchShapeLite<span class="token punctuation">:</span><span class="token punctuation">:</span>slotresult<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	json<span class="token punctuation">[</span><span class="token string">&quot;levels&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
	json<span class="token punctuation">[</span><span class="token string">&quot;search_number&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	json<span class="token punctuation">[</span><span class="token string">&quot;min_score&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0.8</span><span class="token punctuation">;</span>
	json<span class="token punctuation">[</span><span class="token string">&quot;use_subpixle&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> true<span class="token punctuation">;</span>
	json<span class="token punctuation">[</span><span class="token string">&quot;low_thresh&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	json<span class="token punctuation">[</span><span class="token string">&quot;high_thresh&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	json<span class="token punctuation">[</span><span class="token string">&quot;start_angle&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">30</span><span class="token punctuation">;</span>
	json<span class="token punctuation">[</span><span class="token string">&quot;end_angle&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
	json<span class="token punctuation">[</span><span class="token string">&quot;angle_step&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

	QJsonArray pattern_arr<span class="token punctuation">;</span>
	pattern_arr<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	pattern_arr<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	pattern_arr<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	pattern_arr<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	json<span class="token punctuation">[</span><span class="token string">&quot;pattern_rect&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> pattern_arr<span class="token punctuation">;</span>

	sBar <span class="token operator">=</span> <span class="token function">statusBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	label <span class="token operator">=</span> new <span class="token function">QLabel</span><span class="token punctuation">(</span>this<span class="token punctuation">)</span><span class="token punctuation">;</span>
	sBar<span class="token operator">-&gt;</span><span class="token function">addWidget</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">;</span>
	label<span class="token operator">-&gt;</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">&quot;result::&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	image_data_ <span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">15052800</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

MatchShapeLite<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">~</span><span class="token function">MatchShapeLite</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>display<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		delete display<span class="token punctuation">;</span>
		display <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> MatchShapeLite<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">slotopen</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	QString default_path <span class="token operator">=</span> <span class="token string">&quot;Data/projects&quot;</span><span class="token punctuation">;</span>
	QString path <span class="token operator">=</span> QFileDialog<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">getExistingDirectory</span><span class="token punctuation">(</span>this<span class="token punctuation">,</span> <span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">&quot;Open Project Directory&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> default_path<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>path <span class="token operator">==</span> <span class="token string">&quot;&quot;</span> <span class="token operator">||</span> path<span class="token punctuation">.</span><span class="token function">isNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	QDir <span class="token function">dir</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
	item_path <span class="token operator">=</span> dir<span class="token punctuation">.</span><span class="token function">absolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>dir<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		
		bool flag <span class="token operator">=</span> workflow_list<span class="token operator">-&gt;</span><span class="token function">readProject</span><span class="token punctuation">(</span>item_path<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>flag<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	QJsonObject json_object<span class="token punctuation">;</span>
	QJsonDocument json_document<span class="token punctuation">;</span>
	path <span class="token operator">=</span> item_path <span class="token operator">+</span> <span class="token string">&quot;/module_info.json&quot;</span><span class="token punctuation">;</span>

	QFile <span class="token function">file</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
	QByteArray byteArray<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>file<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>QIODevice<span class="token punctuation">:</span><span class="token punctuation">:</span>ReadOnly<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	byteArray <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">readAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	QJsonParseError jsonErr<span class="token punctuation">;</span>
	json_document <span class="token operator">=</span> QJsonDocument<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">fromJson</span><span class="token punctuation">(</span>byteArray<span class="token punctuation">,</span> <span class="token operator">&amp;</span>jsonErr<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>jsonErr<span class="token punctuation">.</span>error <span class="token operator">!=</span> QJsonParseError<span class="token punctuation">:</span><span class="token punctuation">:</span>NoError <span class="token operator">&amp;&amp;</span> json_document<span class="token punctuation">.</span><span class="token function">isNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		file<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	file<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	json_object <span class="token operator">=</span> json_document<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	QJsonObject CameraInfo<span class="token punctuation">,</span>MdlParam<span class="token punctuation">,</span>MdlInfo<span class="token punctuation">;</span>
	QJsonArray MdlInfos<span class="token punctuation">,</span>pattern_rect<span class="token punctuation">;</span>

	CameraInfo <span class="token operator">=</span> json_object<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">&quot;CameraInfo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	MdlInfos <span class="token operator">=</span> json_object<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">&quot;MdlInfos&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	MdlInfo <span class="token operator">=</span> MdlInfos<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	MdlParam <span class="token operator">=</span> MdlInfo<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">&quot;MdlParam&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	pattern_rect <span class="token operator">=</span> MdlParam<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">&quot;pattern_rect&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	json <span class="token operator">=</span> MdlParam<span class="token punctuation">;</span>
	ui<span class="token punctuation">.</span>s_angle<span class="token operator">-&gt;</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token function">QString</span><span class="token punctuation">(</span><span class="token string">&quot;%1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>MdlParam<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">&quot;start_angle&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toDouble</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	ui<span class="token punctuation">.</span>l_angle<span class="token operator">-&gt;</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token function">QString</span><span class="token punctuation">(</span><span class="token string">&quot;%1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>MdlParam<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">&quot;end_angle&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toDouble</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	ui<span class="token punctuation">.</span>m_score<span class="token operator">-&gt;</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token function">QString</span><span class="token punctuation">(</span><span class="token string">&quot;%1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>MdlParam<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">&quot;min_score&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toDouble</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	ui<span class="token punctuation">.</span>m_num<span class="token operator">-&gt;</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token function">QString</span><span class="token punctuation">(</span><span class="token string">&quot;%1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>MdlParam<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">&quot;search_number&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>CameraInfo<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">&quot;EmulateModeStatus&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		bool rtn<span class="token punctuation">;</span>
		QString pix_path <span class="token operator">=</span> item_path <span class="token operator">+</span> <span class="token string">&quot;/ReferImage/0.bmp&quot;</span><span class="token punctuation">;</span>

		QPixmap pix<span class="token punctuation">;</span>
		rtn <span class="token operator">=</span> pix<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>pix_path<span class="token punctuation">)</span><span class="token punctuation">;</span>
		display<span class="token operator">-&gt;</span><span class="token function">setImage</span><span class="token punctuation">(</span>pix<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	QRect <span class="token function">roi</span><span class="token punctuation">(</span>pattern_rect<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pattern_rect<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pattern_rect<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pattern_rect<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	display<span class="token operator">-&gt;</span><span class="token function">addRectItem</span><span class="token punctuation">(</span><span class="token string">&quot;target&quot;</span><span class="token punctuation">,</span>roi<span class="token punctuation">)</span><span class="token punctuation">;</span>
	ui<span class="token punctuation">.</span>run<span class="token operator">-&gt;</span><span class="token function">setEnabled</span><span class="token punctuation">(</span>true<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> MatchShapeLite<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">slotsave</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	json<span class="token punctuation">[</span><span class="token string">&quot;search_number&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> ui<span class="token punctuation">.</span>m_num<span class="token operator">-&gt;</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	json<span class="token punctuation">[</span><span class="token string">&quot;min_score&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> ui<span class="token punctuation">.</span>m_score<span class="token operator">-&gt;</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toDouble</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	json<span class="token punctuation">[</span><span class="token string">&quot;start_angle&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> ui<span class="token punctuation">.</span>s_angle<span class="token operator">-&gt;</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	json<span class="token punctuation">[</span><span class="token string">&quot;end_angle&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> ui<span class="token punctuation">.</span>l_angle<span class="token operator">-&gt;</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	bool rtn <span class="token operator">=</span> workflow_list<span class="token operator">-&gt;</span><span class="token function">setMdlParam</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> json<span class="token punctuation">)</span><span class="token punctuation">;</span>

	workflow_list<span class="token operator">-&gt;</span><span class="token function">saveProject</span><span class="token punctuation">(</span>item_path<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> MatchShapeLite<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">slotrun</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	json<span class="token punctuation">[</span><span class="token string">&quot;search_number&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> ui<span class="token punctuation">.</span>m_num<span class="token operator">-&gt;</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	json<span class="token punctuation">[</span><span class="token string">&quot;min_score&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> ui<span class="token punctuation">.</span>m_score<span class="token operator">-&gt;</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toDouble</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	json<span class="token punctuation">[</span><span class="token string">&quot;start_angle&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> ui<span class="token punctuation">.</span>s_angle<span class="token operator">-&gt;</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	json<span class="token punctuation">[</span><span class="token string">&quot;end_angle&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> ui<span class="token punctuation">.</span>l_angle<span class="token operator">-&gt;</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	bool is_capture <span class="token operator">=</span> workflow_list<span class="token operator">-&gt;</span><span class="token function">getMdlCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>

	display<span class="token operator">-&gt;</span><span class="token function">startDrawResult</span><span class="token punctuation">(</span>workflow_list<span class="token operator">-&gt;</span><span class="token function">getDrawableResultPtr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	workflow_list<span class="token operator">-&gt;</span><span class="token function">registerCallback</span><span class="token punctuation">(</span>dealResult<span class="token punctuation">,</span>this<span class="token punctuation">)</span><span class="token punctuation">;</span>
	bool success <span class="token operator">=</span> workflow_list<span class="token operator">-&gt;</span><span class="token function">setMdlParam</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> json<span class="token punctuation">)</span><span class="token punctuation">;</span>
	success <span class="token operator">=</span> workflow_list<span class="token operator">-&gt;</span><span class="token function">startProcess</span><span class="token punctuation">(</span>is_capture<span class="token punctuation">,</span> true<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>success<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>workflow_list<span class="token operator">-&gt;</span><span class="token function">isRunning</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		ui<span class="token punctuation">.</span>run<span class="token operator">-&gt;</span><span class="token function">setEnabled</span><span class="token punctuation">(</span>false<span class="token punctuation">)</span><span class="token punctuation">;</span>
		ui<span class="token punctuation">.</span>quit<span class="token operator">-&gt;</span><span class="token function">setEnabled</span><span class="token punctuation">(</span>true<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
	<span class="token punctuation">{</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> MatchShapeLite<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">slotquit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	display<span class="token operator">-&gt;</span><span class="token function">stopDrawResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	workflow_list<span class="token operator">-&gt;</span><span class="token function">stopProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	ui<span class="token punctuation">.</span>run<span class="token operator">-&gt;</span><span class="token function">setEnabled</span><span class="token punctuation">(</span>true<span class="token punctuation">)</span><span class="token punctuation">;</span>
	ui<span class="token punctuation">.</span>quit<span class="token operator">-&gt;</span><span class="token function">setEnabled</span><span class="token punctuation">(</span>false<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> MatchShapeLite<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">slotUpdateRoi</span><span class="token punctuation">(</span>bool valid<span class="token punctuation">,</span> <span class="token keyword">double</span> reserve0<span class="token punctuation">,</span> <span class="token keyword">double</span> reserve1<span class="token punctuation">,</span>
	<span class="token keyword">double</span> reserve2<span class="token punctuation">,</span> <span class="token keyword">double</span> reserve3<span class="token punctuation">,</span> <span class="token keyword">double</span> reserve4<span class="token punctuation">,</span> QString <span class="token operator">&amp;</span>name<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>valid<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		QJsonArray pattern_arr<span class="token punctuation">;</span>
		pattern_arr<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>reserve0<span class="token punctuation">)</span><span class="token punctuation">;</span>
		pattern_arr<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>reserve1<span class="token punctuation">)</span><span class="token punctuation">;</span>
		pattern_arr<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>reserve2<span class="token punctuation">)</span><span class="token punctuation">;</span>
		pattern_arr<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>reserve3<span class="token punctuation">)</span><span class="token punctuation">;</span>
		json<span class="token punctuation">[</span><span class="token string">&quot;pattern_rect&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> pattern_arr<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> MatchShapeLite<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">dealResult</span><span class="token punctuation">(</span><span class="token keyword">const</span> GtMat <span class="token operator">*</span>image<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>user<span class="token punctuation">,</span> <span class="token keyword">int</span> index<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> size <span class="token operator">=</span> image<span class="token operator">-&gt;</span>rows <span class="token operator">*</span> image<span class="token operator">-&gt;</span>cols <span class="token operator">*</span> image<span class="token operator">-&gt;</span>channel<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>size <span class="token operator">&gt;</span> <span class="token number">15052800</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> nullptr <span class="token operator">||</span> image<span class="token operator">-&gt;</span>image_data <span class="token operator">==</span> nullptr<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	MatchShapeLite <span class="token operator">*</span>lite <span class="token operator">=</span> static_cast<span class="token operator">&lt;</span>MatchShapeLite<span class="token operator">*</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>lite <span class="token operator">==</span> nullptr<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">memcpy</span><span class="token punctuation">(</span>lite<span class="token operator">-&gt;</span>image_data_<span class="token punctuation">,</span> image<span class="token operator">-&gt;</span>image_data<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
	lite<span class="token operator">-&gt;</span>map <span class="token operator">=</span> QPixmap<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">fromImage</span><span class="token punctuation">(</span><span class="token function">QImage</span><span class="token punctuation">(</span><span class="token punctuation">(</span>uchar<span class="token operator">*</span><span class="token punctuation">)</span>lite<span class="token operator">-&gt;</span>image_data_<span class="token punctuation">,</span>
		image<span class="token operator">-&gt;</span>cols<span class="token punctuation">,</span> image<span class="token operator">-&gt;</span>rows<span class="token punctuation">,</span> image<span class="token operator">-&gt;</span>cols <span class="token operator">*</span> image<span class="token operator">-&gt;</span>channel<span class="token punctuation">,</span>
		image<span class="token operator">-&gt;</span>channel <span class="token operator">==</span> <span class="token number">3</span> <span class="token operator">?</span> QImage<span class="token punctuation">:</span><span class="token punctuation">:</span>Format_RGB888 <span class="token punctuation">:</span> QImage<span class="token punctuation">:</span><span class="token punctuation">:</span>Format_Indexed8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	emit lite<span class="token operator">-&gt;</span><span class="token function">signupdate</span><span class="token punctuation">(</span>lite<span class="token operator">-&gt;</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
	emit lite<span class="token operator">-&gt;</span><span class="token function">signresult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> MatchShapeLite<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">slotscan</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	camera <span class="token operator">=</span> workflow_list<span class="token operator">-&gt;</span><span class="token function">scanCamera</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>camera<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		ui<span class="token punctuation">.</span>camershow<span class="token operator">-&gt;</span><span class="token function">addItems</span><span class="token punctuation">(</span>camera<span class="token punctuation">)</span><span class="token punctuation">;</span>
		ui<span class="token punctuation">.</span>connect<span class="token operator">-&gt;</span><span class="token function">setEnabled</span><span class="token punctuation">(</span>true<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> MatchShapeLite<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">slotconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	QString str <span class="token operator">=</span> ui<span class="token punctuation">.</span>camershow<span class="token operator">-&gt;</span><span class="token function">currentText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	bool rtn <span class="token operator">=</span> workflow_list<span class="token operator">-&gt;</span><span class="token function">connectCamera</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> MatchShapeLite<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">slotupdate</span><span class="token punctuation">(</span>QPixmap map<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	display<span class="token operator">-&gt;</span><span class="token function">setImage</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> MatchShapeLite<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">slotresult</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	QStringList res <span class="token operator">=</span> workflow_list<span class="token operator">-&gt;</span><span class="token function">getMdlResultList</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	QString show<span class="token punctuation">;</span>

	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> res<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> show<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	label<span class="token operator">-&gt;</span><span class="token function">setText</span><span class="token punctuation">(</span>show<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="qt界面示例"><a href="#qt界面示例" aria-hidden="true" class="header-anchor">#</a> QT界面示例</h2> <p><img src="https://coding.net/api/project/2904101/files/4612039/imagePreview" alt="图片"></p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/ui_program/ui_program_intro.html" class="prev">
          自定义视觉界面
        </a></span> <span class="next"><a href="/ui_program/ui_update_log.html">
          更新日志
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.e904eec8.js" defer></script><script src="/assets/js/16.16066f5a.js" defer></script>
  </body>
</html>
